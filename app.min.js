/*! jsbootcamp 2013-11-03 */
var path=require("path"),express=require("express"),_=require("underscore"),app=express().set("views",path.join(__dirname,"views")).set("view engine","hbs").use(express.static(path.join(__dirname,"public"))).use(express.bodyParser()),db=[{guid:"c214d676-a056-4e77-914c-dfa96e5c93b8",firstName:"Homer",lastName:"Simpson",nickname:"Homer",company:"Springfield Nuclear Powerplant",email:"hsimpson74@yahoo.com"},{guid:"a9816058-5e20-4e19-be7a-b9ec320a7a91",firstName:"Marjorie",lastName:"Simpson",nickname:"Marge",company:"",email:"funmom1337@hotmail.com"},{guid:"ba029c24-2229-4439-a280-452bead4f176",firstName:"Jeff",lastName:"Albertson",nickname:"Comic Book Guy",company:"The Android's Dungeon & Baseball Card Shop",email:"treknerk1012@comcast.net"},{guid:"5344717e-5433-49ca-9b71-5fc26ad86abc",firstName:"Charles Montgomery",lastName:"Burns",nickname:"Monty",company:"Springfield Nuclear Powerplant",email:""},{guid:"0e33a96d-a16c-43e2-be5e-1698393e6dbb",firstName:"Joseph",lastName:"Quimby",nickname:"Diamond Joe",company:"Mayor of Springfield",email:"jquimby@springfield.gov"}];app.get("/",function(a,b){b.redirect("/contacts")}),app.get("/contacts",function(a,b){b.render("contactlist",{contacts:db})}),app.get("/test",function(a,b){b.render("test",{contacts:db})}),app.get("/contacts/:guid",function(a,b){var c=a.param("guid"),d=_.findWhere(db,{guid:c});d?b.render("contact",{contact:d}):b.send("Sorry, the guid "+c+" doesn't exist in the DB.")}),app.post("/contacts/:guid",function(a,b){var c=a.param("guid"),d=_.findWhere(db,{guid:c});if(d){var e=_.pick(a.body,"firstName","lastName","nickname","company","email");_.extend(d,e),""===d.nickname&&(d.nickname=d.firstName),b.redirect("/contacts")}else b.send("Sorry, the guid "+c+" doesn't exist in the DB.")});var port=process.env.PORT||3e3;app.listen(port),console.log("The server is now listening on port %s",port);